---
name: "openvpn"
packages:
  - "openvpn"
templates:
  bin/apply-iptables.erb: "bin/apply-iptables"
  bin/write-ccd.erb: "bin/write-ccd"
  bin/write-clients.erb: "bin/write-clients"
  bin/control: "bin/control"
  bin/control-client: "bin/control-client"
  etc/ca.crt.erb: "etc/ca.crt"
  etc/crl.pem.erb: "etc/crl.pem"
  etc/dh.pem.erb: "etc/dh.pem"
  etc/openvpn.conf.erb: "etc/openvpn.conf"
  etc/server.crt.erb: "etc/server.crt"
  etc/server.key.erb: "etc/server.key"
properties:
  protocol:
    default: tcp
    description: "Protocol for the server"
    type: "string"
    enum:
      - udp
      - tcp
  port:
    default: 1194
    description: "Bind Port for the server"
    type: "integer"
  extra_config:
    default: ~
    description: "Custom OpenVPN configuration statements"
    type: "text"
    help: |
          For more details, see the [manual](https://community.openvpn.net/openvpn/wiki/Openvpn23ManPage) with all the available options.
  local:
    default: "0.0.0.0"
    description: "Bind IP for the server"
    regex: "\\d{1,3}.\\d{1,3}.\\d{1,3}.\\d{1,3}"
    type: "string"
  server:
    description: "VPN IP and netmask"
    regex: "\\d{1,3}.\\d{1,3}.\\d{1,3}.\\d{1,3} \\d{1,3}.\\d{1,3}.\\d{1,3}.\\d{1,3}"
    type: "string"
    help: |
          This is the basis of the IP pool which the server will allocate to clients.
  routes:
    default: []
    description: "Routes for the local routing table"
    type: "string[]"
    help: |
          These will be added to the local kernel's routing table and should be in the format of "192.0.2.0 255.255.255.0".
  push_routes:
    default: []
    description: "Routes to push to connecting clients"
    type: "string[]"
    help: |
          These should be in a format similar to "192.0.2.0 255.255.255.0".
  push_dns:
    default: []
    description: "DNS servers to push to connecting clients"
    type: "string[]"
    help: |
          This should be a list of DNS server IP adddresses that should be pushed to
          connecting clients to enable DNS resolution over the VPN tunnel.
  push_dns_search_domains:
    default: []
    description: "List of search domains to push to clients"
    type: "string[]"
    help: |
          This should be a list of domains that should be pushed to connecting clients
          for use as DNS search domains.
  compress:
    description: "Default compression (or empty to disable)"
    default: ~
    type: "string"
    enum:
      - lzo
      - lz4
  push_compress:
    description: "Push default compression setting to clients"
    default: true
    type: "boolean"
  cipher:
    description: "Cipher for encrypting packets"
    default: "BF-CBC"
    type: "string"
  keysize:
    description: "Size of cipher key in bits"
    default: 256
    type: "integer"
  tls_version_min:
    description: "The minimum TLS version accepted from peers"
    default: "1.0"
    type: "string"
  tls_cipher:
    description: "A colon-separated list of allowable TLS ciphers"
    type: "string"
    example: "DEFAULT:!EXP:!LOW:!MEDIUM"
  ca_crt:
    description: "CA Certificate"
    help: |
          This should include `-----BEGIN CERTIFICATE-----` through `-----END CERTIFICATE-----`.
    type: "text"
  server_crt:
    description: "Server Certificate"
    type: "text"
    help: |
          This should include `-----BEGIN CERTIFICATE-----` through `-----END CERTIFICATE-----`.
  server_key:
    description: "Server Key"
    type: "text"
    help: |
          This should include `-----BEGIN RSA PRIVATE KEY-----` through `-----END RSA PRIVATE KEY-----`.
  dh_pem:
    description: "Diffie-Hellmann Key"
    type: "text"
    help: |
          This should include `-----BEGIN DH PARAMETERS-----` through `-----END DH PARAMETERS-----`.
  crl_pem:
    description: "Certificate Revocation List"
    type: "text"
    help: |
          This should inclulde `-----BEGIN X509 CRL-----` through `-----END X509 CRL-----`.
  ccd:
    description: "A list of Client Configuration Directives"
    help: |
          This value is an array, with each client being an array whose first value is the client's common name and second value is the OpenVPN directives.
    default: []
    type: "array[]"
  iptables:
    description: "IPTable rules to manage"
    default: []
    type: "string[]"
    example:
      - "POSTROUTING -t nat -s 192.0.2.0/24 -d 10.10.1.0/24 -j MASQUERADE -m comment --comment 'vpn -> private lan'"
      - "POSTROUTING -t nat -s 192.0.2.0/24 -d 10.10.2.100/32 -j MASQUERADE -m comment --comment 'vpn -> internal backup server'"
  client_config:
    description: "A list of Client Configuration Connections"
    help: |
          This value is an array, with each client connection being an item.
    default: []
    type: "array[]"
